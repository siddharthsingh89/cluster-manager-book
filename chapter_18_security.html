<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Chapter 18 - Security &amp; Multi-Tenant Isolation</title>


        <!-- Custom HTML head -->
		<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M9H5JQ7QYR"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-M9H5JQ7QYR');
</script>	
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="chapter-18---security--multi-tenant-isolation"><a class="header" href="#chapter-18---security--multi-tenant-isolation"><strong>Chapter 18 - Security &amp; Multi-Tenant Isolation</strong></a></h1>
<p>Security is not an afterthought in distributed database systems; it is woven through every layer - from authentication and access control to encryption, auditing, and tenant isolation. In this chapter, we will explore the principles, architecture, and implementation patterns that ensure secure data operations and strong separation between tenants in a shared infrastructure.</p>
<hr />
<h2 id="181-goals-of-security-architecture"><a class="header" href="#181-goals-of-security-architecture"><strong>18.1 Goals of Security Architecture</strong></a></h2>
<p>A secure distributed database must achieve the following objectives:</p>
<ol>
<li><strong>Confidentiality</strong> – Ensure data is visible only to authorized entities.</li>
<li><strong>Integrity</strong> – Prevent unauthorized or accidental data modification.</li>
<li><strong>Availability</strong> – Ensure the system remains accessible under attack or fault.</li>
<li><strong>Isolation</strong> – Guarantee tenant-level separation in multi-tenant systems.</li>
<li><strong>Traceability</strong> – Provide audit trails for all security-sensitive operations.</li>
</ol>
<p>These objectives guide design choices across identity, access, encryption, and operational policies.</p>
<hr />
<h2 id="182-identity--authentication"><a class="header" href="#182-identity--authentication"><strong>18.2 Identity &amp; Authentication</strong></a></h2>
<p>Every request in the system must be attributable to a <strong>principal</strong> - a user, service, or application identity. Authentication establishes this principal before any operation is permitted.</p>
<h3 id="1821-authentication-mechanisms"><a class="header" href="#1821-authentication-mechanisms"><strong>18.2.1 Authentication Mechanisms</strong></a></h3>
<ul>
<li><strong>Token-Based (JWT/OAuth2):</strong> Common in API-driven systems where statelessness and delegation are required.</li>
<li><strong>Mutual TLS:</strong> Used in service-to-service communication for strong cryptographic identity.</li>
<li><strong>API Keys / Service Credentials:</strong> Suitable for internal machine users, stored in secure vaults.</li>
<li><strong>Federated Identity (OIDC/SAML):</strong> Enables integration with enterprise SSO providers.</li>
</ul>
<h3 id="1822-service-identity-example"><a class="header" href="#1822-service-identity-example"><strong>18.2.2 Service Identity Example</strong></a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct ServiceIdentity {
    service_name: String,
    certificate: X509Cert,
    private_key: PrivateKey,
}

impl ServiceIdentity {
    fn sign_request(&amp;self, req: &amp;mut Request) {
        let signature = crypto::sign(req.body(), &amp;self.private_key);
        req.headers.insert("X-Service-Signature", signature);
    }
}
<span class="boring">}</span></code></pre></pre>
<p>This mechanism allows microservices in a distributed setup to mutually authenticate and establish trust boundaries.</p>
<hr />
<h2 id="183-authorization--access-control"><a class="header" href="#183-authorization--access-control"><strong>18.3 Authorization &amp; Access Control</strong></a></h2>
<p>Once authenticated, the system must determine <em>what</em> a principal can do. This is governed by authorization rules.</p>
<h3 id="1831-role-based-access-control-rbac"><a class="header" href="#1831-role-based-access-control-rbac"><strong>18.3.1 Role-Based Access Control (RBAC)</strong></a></h3>
<ul>
<li><strong>Roles:</strong> Define sets of permissions.</li>
<li><strong>Policies:</strong> Bind users or services to roles.</li>
<li><strong>Scopes:</strong> Limit the permission to specific databases, tables, or keys.</li>
</ul>
<p>Example:</p>
<pre><code class="language-json">{
  "role": "reader",
  "permissions": ["SELECT"],
  "scope": "tenant:1234/database:analytics"
}
</code></pre>
<h3 id="1832-attribute-based-access-control-abac"><a class="header" href="#1832-attribute-based-access-control-abac"><strong>18.3.2 Attribute-Based Access Control (ABAC)</strong></a></h3>
<p>Policies can use context:</p>
<ul>
<li>Time of access</li>
<li>Network location</li>
<li>Tenant ID</li>
<li>Data classification (confidential, public)</li>
</ul>
<p>Example Policy:</p>
<blockquote>
<p>“Allow SELECT only if <code>tenant_id</code> matches token and <code>data_label != confidential</code>.”</p>
</blockquote>
<hr />
<h2 id="184-encryption--key-management"><a class="header" href="#184-encryption--key-management"><strong>18.4 Encryption &amp; Key Management</strong></a></h2>
<p>Encryption protects data at rest, in transit, and sometimes even in use (via confidential computing).</p>
<h3 id="1841-encryption-in-transit"><a class="header" href="#1841-encryption-in-transit"><strong>18.4.1 Encryption in Transit</strong></a></h3>
<ul>
<li>TLS 1.3 for client connections</li>
<li>mTLS for service-to-service</li>
<li>Strict certificate rotation policies</li>
</ul>
<h3 id="1842-encryption-at-rest"><a class="header" href="#1842-encryption-at-rest"><strong>18.4.2 Encryption at Rest</strong></a></h3>
<ul>
<li>Per-tenant keys derived from a Key Encryption Key (KEK)</li>
<li>Key versioning for rotation</li>
<li>Hardware-backed vaults (e.g., HSM or KMS)</li>
</ul>
<p>Example pseudocode:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn encrypt_with_tenant_key(tenant_id: &amp;str, data: &amp;[u8]) -&gt; EncryptedBlob {
    let key = key_manager::fetch(tenant_id);
    aes_gcm::encrypt(&amp;key, data)
}
<span class="boring">}</span></code></pre></pre>
<h3 id="1843-key-hierarchy"><a class="header" href="#1843-key-hierarchy"><strong>18.4.3 Key Hierarchy</strong></a></h3>
<pre><code>Master Key (KMS)
    ├── Tenant Key 1 (T1)
    ├── Tenant Key 2 (T2)
    └── Log Key (system audit)
</code></pre>
<hr />
<h2 id="185-multi-tenant-isolation"><a class="header" href="#185-multi-tenant-isolation"><strong>18.5 Multi-Tenant Isolation</strong></a></h2>
<p>In a multi-tenant database, strong isolation ensures that no tenant can access or impact another tenant’s data, performance, or resources.</p>
<h3 id="1851-isolation-models"><a class="header" href="#1851-isolation-models"><strong>18.5.1 Isolation Models</strong></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Level</th><th>Strategy</th><th>Description</th></tr></thead><tbody>
<tr><td>Logical</td><td>Shared schema with tenant_id column</td><td>Fast but weak isolation</td></tr>
<tr><td>Database</td><td>Separate database per tenant</td><td>Balanced trade-off</td></tr>
<tr><td>Physical</td><td>Dedicated nodes per tenant</td><td>Strongest isolation</td></tr>
</tbody></table>
</div>
<h3 id="1852-resource-quotas"><a class="header" href="#1852-resource-quotas"><strong>18.5.2 Resource Quotas</strong></a></h3>
<ul>
<li><strong>CPU/Memory limits per tenant</strong></li>
<li><strong>I/O and storage throttling</strong></li>
<li><strong>Connection pool limits</strong></li>
</ul>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn enforce_quota(tenant_id: &amp;str, resource: ResourceType) -&gt; Result&lt;()&gt; {
    let quota = quota_manager::get(tenant_id, resource);
    if quota.is_exceeded() {
        return Err(Error::ResourceLimitExceeded);
    }
    Ok(())
}
<span class="boring">}</span></code></pre></pre>
<h3 id="1853-metadata-partitioning"><a class="header" href="#1853-metadata-partitioning"><strong>18.5.3 Metadata Partitioning</strong></a></h3>
<p>Metadata services (like placement or configuration registries) must maintain per-tenant namespaces.</p>
<p>Example:</p>
<pre><code>/meta/tenant_1234/replicas
/meta/tenant_1234/config
/meta/tenant_5678/replicas
</code></pre>
<p>This avoids cross-tenant leaks and ensures control-plane operations are scoped correctly.</p>
<hr />
<h2 id="186-auditing--compliance"><a class="header" href="#186-auditing--compliance"><strong>18.6 Auditing &amp; Compliance</strong></a></h2>
<p>All security events should be captured and stored in tamper-evident logs.</p>
<h3 id="1861-audit-events"><a class="header" href="#1861-audit-events"><strong>18.6.1 Audit Events</strong></a></h3>
<ul>
<li>User login, token issuance, and expiry</li>
<li>Data access and modifications</li>
<li>Admin policy updates</li>
<li>Key rotations</li>
</ul>
<h3 id="1862-immutable-audit-storage"><a class="header" href="#1862-immutable-audit-storage"><strong>18.6.2 Immutable Audit Storage</strong></a></h3>
<ul>
<li>Append-only event log</li>
<li>Merkle-tree hash chain for tamper detection</li>
<li>Write-once storage (e.g., WORM)</li>
</ul>
<p>Example:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn append_audit_log(event: AuditEvent) {
    let hash = hash_chain::link(event);
    audit_store.append(hash);
}
<span class="boring">}</span></code></pre></pre>
<hr />
<h2 id="187-threat-modeling--attack-surfaces"><a class="header" href="#187-threat-modeling--attack-surfaces"><strong>18.7 Threat Modeling &amp; Attack Surfaces</strong></a></h2>
<h3 id="common-threats"><a class="header" href="#common-threats"><strong>Common Threats</strong></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Threat</th><th>Description</th><th>Mitigation</th></tr></thead><tbody>
<tr><td>Unauthorized Access</td><td>Stolen tokens or leaked keys</td><td>Short-lived tokens, mTLS, vault storage</td></tr>
<tr><td>Data Leakage</td><td>Cross-tenant access or misconfiguration</td><td>Namespace isolation, policy enforcement</td></tr>
<tr><td>Replay Attacks</td><td>Reuse of old signed requests</td><td>Nonce + timestamp validation</td></tr>
<tr><td>Insider Threats</td><td>Privileged misuse</td><td>Immutable audit logs, four-eye review</td></tr>
</tbody></table>
</div>
<hr />
<h2 id="188-security-contracts"><a class="header" href="#188-security-contracts"><strong>18.8 Security Contracts</strong></a></h2>
<h3 id="api-securitycontract"><a class="header" href="#api-securitycontract"><strong>API SecurityContract</strong></a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>trait SecurityContract {
    fn authenticate(req: &amp;Request) -&gt; AuthPrincipal;
    fn authorize(principal: &amp;AuthPrincipal, action: &amp;str, resource: &amp;str) -&gt; bool;
    fn encrypt(data: &amp;[u8], tenant_id: &amp;str) -&gt; Vec&lt;u8&gt;;
    fn audit(event: AuditEvent);
}
<span class="boring">}</span></code></pre></pre>
<p>This contract can be implemented by the system’s <strong>security middleware</strong>, enforcing identity, access, and audit consistently across services.</p>
<hr />
<h2 id="189-challenges--exercises"><a class="header" href="#189-challenges--exercises"><strong>18.9 Challenges &amp; Exercises</strong></a></h2>
<p><strong>Challenges</strong></p>
<ol>
<li>Design a per-tenant key rotation protocol that avoids downtime.</li>
<li>Implement row-level access control using tenant_id + data_label attributes.</li>
<li>Model audit log integrity verification using Merkle chains.</li>
</ol>
<p><strong>Exercises</strong></p>
<ul>
<li>Simulate token expiry and refresh workflow in a distributed cluster.</li>
<li>Evaluate performance impact of encryption at rest for large datasets.</li>
</ul>
<hr />
<h2 id="summary"><a class="header" href="#summary"><strong>Summary</strong></a></h2>
<p>Security and isolation are not features - they are foundational to trust in any distributed database. A robust security model provides guarantees that:</p>
<ul>
<li>Each tenant’s data remains private and controlled.</li>
<li>Operations are accountable and traceable.</li>
<li>Keys, tokens, and policies evolve safely without downtime.</li>
</ul>
<p>In the next chapter, we will examine <strong>Observability &amp; Diagnostics</strong>, exploring how telemetry, tracing, and logging can provide insights into the secure and efficient functioning of the entire distributed system.</p>
<hr />

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="chapter_17_configuration_management.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="chapter_19_observability.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="chapter_17_configuration_management.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="chapter_19_observability.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
